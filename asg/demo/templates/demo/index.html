<!DOCTYPE html>
<html lang="">


<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ===========================
THEME INFO
=========================== -->
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">

<!-- ===========================
SITE TITLE
=========================== -->
<title>Automatic Survey Paper Generation</title>

<!-- ===========================
FAVICONS
=========================== -->
<!--<link rel="icon" href="img/favicon.png">-->
{% load static %}
<link rel="apple-touch-icon" sizes="144x144" href="{% static 'img/apple-touch-icon-ipad-retina.png' %}" />
<link rel="apple-touch-icon" sizes="114x114" href="{% static 'img/apple-touch-icon-iphone-retina.png' %}" />
<link rel="apple-touch-icon" sizes="72x72" href="{% static 'img/apple-touch-icon-ipad.png' %}" />
<link rel="apple-touch-icon" sizes="57x57" href="{% static 'img/apple-touch-icon-iphone.png' %}" />

<!-- ===========================
STYLESHEETS
=========================== -->
<script src="https://kit.fontawesome.com/a3d039cc94.js" crossorigin="anonymous"></script>

<link rel="stylesheet" href="{% static 'css/fontawesome-free-5.13.0-web/css/fontawesome.min.css' %}">
<link rel="stylesheet" href="{% static 'css/fontawesome-free-5.13.0-web/css/brands.css' %}">
<link rel="stylesheet" href="{% static 'css/fontawesome-free-5.13.0-web/css/solid.css' %}">
<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link rel="stylesheet" href="{% static 'css/responsive.css' %}">

<style>

.file {
    position: relative;
    display: inline-block;
    background: #D0EEFF;
    border: 1px solid #99D3F5;
    border-radius: 4px;
    padding: 4px 12px;
    overflow: hidden;
    color: #1E88C7;
    text-decoration: none;
    text-indent: 0;
    line-height: 20px;
}
.file input {
    position: absolute;
    font-size: 100px;
    right: 0;
    top: 0;
    opacity: 0;
}
.file:hover {
    background: #AADFFD;
    border-color: #78C3F3;
    color: #004974;
}

.popover{
    max-width: 100%; /* Max Width of the popover (depending on the container!) */

}
</style>

<!-- ===========================
FONTS & ICONS
=========================== -->
<!--<link href='http://fonts.googleapis.com/css?family=Kristi|Alegreya+Sans:300' rel='stylesheet' type='text/css'>-->
<!--<link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">-->



<!--[if IE]>
	<script src="https://cdn.jsdelivr.net/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://cdn.jsdelivr.net/respond/1.4.2/respond.min.js"></script>
	<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<![endif]-->
</head>

<body>
{% block body %}
<div class="container">
	<!-- ===========================
	HEADER
	============================ -->
	<div class="jumbotron">
		<h1 align="center" > Let Machine Write Surveys</h1>
		<h2 align="right"> --- Automatic Survey Paper Generation</h2>
		<br>
		<br>
	</div>
	<hr class="firsthr">


	<!-- ===========================
	HEADER
	============================ -->
	<div class="col-md-12">
		<!-- <h2 align="left"> <span class="fas fa-sitemap"></span>  Workflow of the Demo: </h2> -->
			<div align="center">
				<img src="{% static 'img/motivation.gif' %}" style="width:800px;height:450px;", id="workflow_img" >
			</div>
		<br>
		<br>
	</div>
	<hr class="firsthr">

	<!-- ===========================
	CHOOSE TOPICS
	============================ -->
	<div class="col-md-12">

			<div class="row">
				<div id="select_refs">
				<h2 align="left"> <span class="fas fa-tags"></span>  Choose a topic from: </h2>
				<!--<div class="col-md-1"></div>-->
				<div class="col-md-12">
					<form action="" method="post", id="topic_form">
						{% csrf_token %}
						<div class="btn-group btn-group-justified" role="group" aria-label="...">
							<label class="btn btn-default" style="height:80px">
								<input type="radio" name="topics" id="option1" value="2742488"> Energy Efficiency in Cloud Computing
							</label>
							<label class="btn btn-default" style="height:80px">
								<input type="radio" name="topics" id="option2" value="2830555"> Cache Management for Real-Time Systems
							</label>
							<label class="btn btn-default" style="height:80px">
								<input type="radio" name="topics" id="option3" value="2907070"> Predictive Modeling on Imbalanced Data
							</label>
						</div>
						<br>
						<div class="btn-group btn-group-justified" role="group" aria-label="...">
							<label class="btn btn-default" style="height:80px">
								<input type="radio" name="topics" id="option4" value="3073559"> Malware Detection with Data Mining
							</label>
							<label class="btn btn-default" style="height:80px">
								<input type="radio" name="topics" id="option5" value="3274658"> Analysis of Handwritten Signature
							</label>
							<label class="btn btn-info" style="height:80px" onclick="sub_topic()">
							<!--<label class="btn btn-info" style="height:80px" onclick="select_sections()">-->
								Reference Selection
							</label>

						</div>
						<br>
					</form>
				</div>
				</div>

						<!--<div class="input-group mb-3">-->
						  <!--<div class="input-group-prepend">-->
							<!--<span class="input-group-text" id="basic-addon1">@</span>-->
						  <!--</div>-->
							<!--<form action="" method="post", id="topic_input">-->
								<!--{% csrf_token %}-->
						  		<!--&lt;!&ndash;<input type="text" class="form-control" name="topics" id="option6" placeholder="Input a topic" aria-label="Username" aria-describedby="basic-addon1">&ndash;&gt;-->
								<!--<input type="text" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="basic-addon1">-->
							<!--</form>-->
						<!--</div>-->





				<!--<div class="col-md-1"></div>-->
			</div>
			<br>
			<div id="input_ref">
			<h2 align="left" id="input_ref_head"> <span class="fas fa-tags"></span>  Or you can also input topic by yourself: </h2>
			<form action="" method="post", id="topic_input" enctype=”multipart/form-data”>
				{% csrf_token %}
				<div class="row">
					<div class="col-md-12">
						<div class="col-xs-0 col-sm-0 col-md-0 col-lg-0">
						</div>
						<div class="input-group col-xs-12 col-sm-12 col-md-12 col-lg-12">
							<input type="text" placeholder="Input topic by yourself" class="form-control" required="required" id="topic_input_box" name="topic">
						</div>
						<div class="col-xs-0 col-sm-0 col-md-0 col-lg-0"></div>
					</div>
				</div>
				<br>
				<div class="row">
					<div class="col-md-12">
						<div class="col-md-8 file">
							Choose References from your computer (txt form)
							<input id="file" type="file" name="file" multiple onchange="handleFiles(this.files)">
						</div>
						<button type="button" class="col-md-4 btn btn-info" onclick="upload_file()">
							<i class="fa fa-paperclip" aria-hidden="true"></i>Upload Reference
						</button>
					</div>
				</div>
			</form>
			</div>
	</div>

	<!-- ===========================
     References
    ============================ -->
	<div class="col-md-12" style="display: none" id="refs">
		<h2 align="left" id="refs_head"> <span class="fas fa-copy"></span> Here are the most related references from our dataset: </h2>
		<form action="" method="post", id="ref_form">
			{% csrf_token %}
			<div class="list-group pre-scrollable" id="ref_list">
			</div>
		</form>
		<p align="right"> *(Select the references for instant survey generation)</p>
		<form action="" method="post", id="tax_std">
			{% csrf_token %}
			<input placeholder="Please input your taxonomy standard" class="form-control", id="taxonomy_standard">
			<p></p>
		</form>

		<div style="text-align: center">
			<input class="btn btn-info" onclick="display_taxonomy()" value="Automatic Taxonomy">
		</div>
	</div>
	<hr class="firsthr">
	<!-- ===========================
     Taxonomy Result
    ============================ -->
	<div class="col-md-12" style="display: none" id="taxonomy">
		<h2 align="left"> <span class="fas fa-chart-pie"></span> The Categorization Result of Selected References based on the chosen taxonomy standard: </h2>

		<div class="row">
			<div class="col-md-7" style="height:400px;">
				<img src="#" style="width:400px;height:400px;", id="tsne_img">
			</div>
			<div class="col-md-5" style="height:400px;">
					<p>  </p>
					<ul id="legend" style="position: relative;top: 30%;transform: translateY(-30%);">
					</ul>
			</div>
		</div>
		<br>
		<br>
		<hr class="firsthr">
		<div style="text-align: center">
			<input class="btn btn-info" onclick="display_select_sections()" value="Generate Survey Content" style="width: 200px">
		</div>
	</div>


	<!-- ===========================
     Select Sections
    ============================ -->
	<div class="col-md-12" style="display: none" id="sections">
		<br>
		<h3 align="left"> Please Choose the sections (subsections) you want to generate: </h3>
		<form action="" method="post", id="sections">
			{% csrf_token %}
			<div class="form-check">
			  <input class="form-check-input" type="checkbox" name="Title" value="Title" id="cbx_title" >
			  <label class="form-check-label" for="cbx_title">
				Title
			  </label>
			<div class="form-check">
			  <input class="form-check-input" type="checkbox" name="Abstract" value="Abstract" id="cbx_abstract" >
			  <label class="form-check-label" for="cbx_abstract">
				Abstract
			  </label>
			</div>
			<div class="form-check">
			  <input class="form-check-input" type="checkbox" name="Introduction" value="Introduction" id="cbx_introduction" >
			  <label class="form-check-label" for="cbx_introduction">
				Introduction
			  </label>
				<div class="row">
					<div class="col-sm-1 form-check" style="width: 10px"></div>
					<div class="col-sm-10 form-check">
						<input class="form-check-input" type="checkbox" name="Background" value="Background" id="cbx_background" >
						<label class="form-check-label" for="cbx_background">
							Background
						</label>
					</div>
					<div class="col-sm-1 form-check"></div>
				</div>
				<div class="row">
					<div class="col-sm-1 form-check" style="width: 10px"></div>
					<div class="col-sm-10 form-check">
						<input class="form-check-input" type="checkbox" name="Method" value="Method" id="cbx_method" >
						<label class="form-check-label" for="cbx_method">
							Method
						</label>
					</div>
					<div class="col-sm-1 form-check"></div>
				</div>
				<div class="row">
					<div class="col-sm-1 form-check" style="width: 10px"></div>
					<div class="col-sm-10 form-check">
						<input class="form-check-input" type="checkbox" name="Reminder" value="Reminder" id="cbx_reminder" >
						<label class="form-check-label" for="cbx_reminder">
							Reminder
						</label>
					</div>
					<div class="col-sm-1 form-check"></div>
				</div>
			</div>
			<div class="form-check">
			  <input class="form-check-input" type="checkbox" name="Methodology" value="Methodology" id="cbx_methodology" >
			  <label class="form-check-label" for="cbx_methodology">
				Methodology
			  </label>
			</div>
			<div class="form-check">
			  <input class="form-check-input" type="checkbox" name="Conclusion" value="Conclusion" id="cbx_conclusion" >
			  <label class="form-check-label" for="cbx_conclusion">
				Conclusion
			  </label>
			</div>
			<div style="text-align: center">
				<input class="btn btn-info" onclick="select_sections()" value="Confirm">
			</div>
		</form>

	</div>

	<!-- ===========================
     Content Modification
    ============================ -->
	<div class="col-md-12" style="display: none" id="modification">
		<form action="" method="post", id="content_modify">
			{% csrf_token %}
		</form>

		<div style="text-align: center">
			<input class="btn btn-info" onclick="display_survey()" value="Confirm">
		</div>
	</div>


	<!-- ===========================
     Generated survey
    ============================ -->
	<div class="col-md-12" style="display: none" id="survey">
		<h2 align="left"> <span class="fas fa-scroll"></span> Here is the generated survey: </h2>
		<div class="row">
			<div class="col-md-0"></div>
			<div class="col-md-12">
				<button type="button" class="btn btn-info"  title="This is the Learned Survey Template"
						data-toggle="popover" data-placement="bottom"
						data-content="" id="template" style="float: right;">
					Survey Template
				</button>

			</div>
		</div>
		<div class="container pre-scrollable col-md-12" style="max-height: 700px" id="survey_content">
		</div>
	</div>

	<div class="col-md-12" style="display: none" id="references"></div>


</div><!--container end-->

<!-- =========================== Script ============================ -->
{% block script %}
{% endblock%}
<script>

	var global_refs = {};

	const inputElement = document.getElementById("file");
	inputElement.addEventListener("change", handleFiles, false);
	function handleFiles() {
  		const fileList = this.files; /* now you can work with the file list */
	}

    function upload_file(){
		const ref_list = []
    	const fileList = document.getElementById("file").files; /* now you can work with the file list */
  		for (let i = 0, numFiles = fileList.length; i < numFiles; i++) {
  			ref_list.push(fileList[i].name);
  		}
    	$.ajax({
			type: "POST",
			dataType: "json",
			url: "/upload_refs",
			data: {
				'topic': $('#topic_input_box').val(),
				'files': ref_list
			},
			success: function(result) {
				for (let i = 0, len = result['references'].length; i < len; i++) {
					document.getElementById("ref_list").innerHTML += "<div class=\"input-group\"><span class=\"input-group-addon\"><input name=\"refs\" type=\"checkbox\" value="+result['ref_ids'][i] + " checked></span><a href=" + encodeURI(result['ref_links'][i])+ " target=\"_blank\" class=\"list-group-item\">" + result['references'][i] + "</a></div>";
				}
				$("#refs").attr("style","display:inline;");
				$("#select_refs").attr("style","display:none;");
				$("#input_ref_head").html("<span class=\"fas fa-tags\"></span> You can input topic by yourself:");
				$("#refs_head").html("<span class=\"fas fa-copy\"></span> Here are the uploaded references:");
			},
			error: function(jqXHR, textStatus, errorThrown){
				alert(jqXHR.responseText);
				/*
				alert(jqXHR.status);
				alert(jqXHR.readyState);
				alert(jqXHR.statusText);
				alert(textStatus);
				alert(errorThrown);
				*/
			}
		});
	}


    function sub_topic(){
    	//alert($('#topic_form').serialize());
		$.ajax({
			type: "POST",
			dataType: "json",
			url: "/get_topic",
			data: $('#topic_form').serialize(),

			success: function(result) {
				// alert(result);
				for (let i = 0, len = result['references'].length; i < len; i++) {
				// for (const v of result['references']) {
					document.getElementById("ref_list").innerHTML += "<div class=\"input-group\"><span class=\"input-group-addon\"><input name=\"refs\" type=\"checkbox\" value="+result['ref_ids'][i] + " checked></span><a href=" + result['ref_links'][i]+ " target=\"_blank\" class=\"list-group-item\">" + result['references'][i] + "</a></div>";
				}
				$("#refs").attr("style","display:inline;");
				$("#input_ref").attr("style","display:none;");
			},
			error: function(jqXHR, textStatus, errorThrown){
				alert(jqXHR.responseText);
				/*
				alert(jqXHR.status);
				alert(jqXHR.readyState);
				alert(jqXHR.statusText);
				alert(textStatus);
				alert(errorThrown);
				*/
			}
		});
	}


	function display_taxonomy(){
		$.ajax({
			type: "POST",
			dataType: "json",
			url: "/automatic_taxonomy",
			data: $('#ref_form').serialize(),
			success: function(result) {
				// alert("Success!");
				document.getElementById("legend").innerHTML += "<h2>" + $("#taxonomy_standard").val() + "</h2>";
				for (let i = 0, len = result['colors'].length; i < len; i++) {
					document.getElementById("legend").innerHTML += "<li class=\"list-group-item\"; style=\"color: "+ result['colors'][i]+" \">" + result['category_label'][i]+" </li>"
				}
				var addr = "static/img/tsne_";
				addr += result['survey_id'];
				addr += ".png";
				$("#tsne_img").attr("src", addr);
				$("#taxonomy").attr("style","display:inline;");
				// alert(result);
			},
			error: function(jqXHR, textStatus, errorThrown){
				alert(jqXHR.responseText);
			}
		});
	}

	function display_select_sections() {
		$("#sections").attr("style","display:inline;");
	}

	function select_sections() {
		var section_list = {};

			if($('#cbx_title').is(":checked")) {section_list['title'] = 1}
			if($('#cbx_introduction').is(":checked")) {section_list['introduction'] = 1}
			if($('#cbx_abstract').is(":checked")) {section_list['abstract'] = 1}
			if($('#cbx_background').is(":checked")) {section_list['background'] = 1}
			if($('#cbx_method').is(":checked")) {section_list['method'] = 1}
			if($('#cbx_reminder').is(":checked")) {section_list['reminder'] = 1}
			if($('#cbx_methodology').is(":checked")) {section_list['methodology'] = 1}
			if($('#cbx_conclusion').is(":checked")) {section_list['conclusion'] = 1}


		$.ajax({
            type: "POST",
            dataType: "json",
            url: "/select_sections",
            data: section_list,
            success: function(result) {
                for(var p in result) {
                    if (p == "title") {
                        document.getElementById("content_modify").innerHTML+= "<h2 style=\"padding: 0px; color: black\"> Title </h2>";
                        document.getElementById("content_modify").innerHTML+= "<textarea id=section_" + p + " class=\"form-control\">"  + result[p] + "</textarea>";
                    }
                }

                for(var p in result) {
                    if (p == "abstract") {
                        document.getElementById("content_modify").innerHTML+= "<h2 style=\"padding: 0px; color: black\"> Abstract </h2>";
                        document.getElementById("content_modify").innerHTML+= "<textarea id=section_" + p + " class=\"form-control\" rows = \" 15 \">" + result[p][0] + " " + result[p][1] + "</textarea>";

                    }
                }

                for(var p in result) {
                    if (p == "introduction") {
                        document.getElementById("content_modify").innerHTML+= "<h2 style=\"padding: 0px; color: black\"> Introduction </h2>";
                        document.getElementById("content_modify").innerHTML+= "<textarea id=section_" + p + " class=\"form-control\" rows = \" 20 \">" + result[p] + "</textarea>";
                    }
                }

                for(var p in result) {
                    if (p == "methodology") {
                        document.getElementById("content_modify").innerHTML+= "<h2 style=\"padding: 0px; color: black\"> Methodology </h2>";
                        document.getElementById("content_modify").innerHTML+= "<textarea id=section_" + p + " class=\"form-control\" rows = \" 10 \">" + result[p][0] + "</textarea><p>";
                        for(var inner_json in result[p][1]) {
                            document.getElementById("content_modify").innerHTML+= "<h3 style=\"padding: 0px; color: black\"> Sub-section </h3>";
                            document.getElementById("content_modify").innerHTML+= "<textarea name=\"method_sub_title\" class=\"form-control\" rows = \" 1 \">" + result[p][1][inner_json]["subtitle"] + "</textarea><p>";
                            document.getElementById("content_modify").innerHTML+= "<textarea name=\"method_sub_content\" class=\"form-control\" rows = \" 30 \">" + result[p][1][inner_json]["content"] + "</textarea><p>";
                        }
                    }
                }
                for(var p in result) {
                    if (p == "conclusion") {
                        document.getElementById("content_modify").innerHTML+= "<h2 style=\"padding: 0px; color: black\">Conclusion</h2>";
                        document.getElementById("content_modify").innerHTML+= "<textarea id=section_" + p + " class=\"form-control\" rows = \" 5 \" >" + result[p] + "</textarea>";
                    }
                }
				for(var p in result) {
                    if (p == "references") {
                        var cnt = 1;
                        for (var entry in result[p]) {
                            document.getElementById("references").innerHTML+= "<p style=\"color:black;\">[" + cnt + "]" + "   " + result[p][entry] + "</p>";
                            cnt = cnt + 1;
                        }
                    }
                }

                $("#modification").attr("style","display:inline;");
            },
            error: function(jqXHR, textStatus, errorThrown){
                alert(jqXHR.responseText);
            }
        });

	}



	function display_survey(){

		if (document.getElementById("section_title")) {
			document.getElementById("survey_content").innerHTML+= "<h1>" + document.getElementById("section_title").value + "</h1>";
		}
		if (document.getElementById("section_abstract")) {
			document.getElementById("survey_content").innerHTML+= "<h2 style=\"padding: 0px; color: black\">Abstract</h2>";
			document.getElementById("survey_content").innerHTML+= "<p align=\"justify\">" + document.getElementById("section_abstract").value + "</p>";
		}
		if (document.getElementById("section_introduction")) {
			document.getElementById("survey_content").innerHTML+= "<h2 style=\"padding: 0px; color: black\">Introduction</h2>";
			document.getElementById("survey_content").innerHTML+= "<p align=\"justify\">" + document.getElementById("section_introduction").value + "</p>";
		}

		if (document.getElementById("section_methodology")) {
			document.getElementById("survey_content").innerHTML+= "<h2 style=\"padding: 0px; color: black\">Methodology</h2>";
			document.getElementById("survey_content").innerHTML+= "<p align=\"justify\">" + document.getElementById("section_methodology").value + "</p>";
			var len = document.getElementsByName("method_sub_title").length;
			for(var i=0; i<len; i++) {
				document.getElementById("survey_content").innerHTML+= "<h3>" + document.getElementsByName("method_sub_title")[i].value + "</h3>";
				document.getElementById("survey_content").innerHTML+= "<p>" + document.getElementsByName("method_sub_content")[i].value + "</p>";
			}

		}

		if (document.getElementById("section_conclusion")) {
			document.getElementById("survey_content").innerHTML+= "<h2 style=\"padding: 0px; color: black\">Conclusion</h2>";
			document.getElementById("survey_content").innerHTML+= "<p align=\"justify\">" + document.getElementById("section_conclusion").value + "</p>";
		}

		document.getElementById("survey_content").innerHTML+= "<h2 style=\"padding: 0px; color: black\"> References </h2>";
		document.getElementById("survey_content").innerHTML+= document.getElementById("references").innerHTML;


		$("#survey").attr("style","display:inline;");
		/*
		$("#template").popover({
			html : true,
			// delay:{show:500, hide:1000},
			// container: 'body',
			content: function() {
				return content();
			}
		});
		*/
	}

</script>


<!--necessary scripts and plugins-->
{% load static %}
<!--<script src="{% static 'scripts/jquery-1.8.3.min.js' %}"></script>-->
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="{% static 'scripts/bootstrap.min.js' %}"></script>
<script src="{% static 'scripts/jquery.nicescroll.min.js' %}"></script>
<script src="{% static 'scripts/evenfly.js' %}"></script>
{% endblock %}

</body>

<footer>
	<p>
	<p>
	<p>
	<!--<h5 align="center" > IMCL NLP Group</h5>-->
</footer>
</html>
